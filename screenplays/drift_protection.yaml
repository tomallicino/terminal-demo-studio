title: "Drift Protection Demo"
output: "drift_demo"
variables:
  tool_name: "delete_prod_db"
  demo_dir: "{{tmp_dir}}/terminal_demo_studio_drift_protection"
settings:
  width: 1440
  height: 900
  font_size: 22
  theme: "TokyoNightStorm"
  padding: 24
  window_bar: "Colorful"
  framerate: 60
  line_height: 1.15
  letter_spacing: 0
preinstall:
  - "rm -rf {{demo_dir}} && mkdir -p {{demo_dir}}"
  - "echo 'Preparing environment for drift demo'"
scenarios:
  - label: "Without Cask"
    surface: "terminal"
    setup:
      - "cd {{demo_dir}}"
      - "export CASK_MODE=unsafe"
      - "echo 'admin_key=redacted' > .env"
    actions:
      - type: "echo '[unsafe] studio run --tool {{tool_name}}'"
      - sleep: "1s"
      - type: "echo 'Deleting production database...'"
      - sleep: "2s"
      - type: "echo 'âœ… Database deleted.'"
  - label: "With Policy Guard"
    surface: "terminal"
    setup:
      - "cd {{demo_dir}}"
      - "export CASK_MODE=safe"
    actions:
      - type: "echo '[safe] studio run --tool {{tool_name}}'"
      - sleep: "500ms"
      - type: "echo 'Analyzing lockfile...'"
      - wait_for: "Analyzing lockfile..."
        wait_mode: "line"
        wait_timeout: "1s"
      - type: "echo '[BLOCK] Policy Violation: Tool {{tool_name}} not in lockfile.'"
      - sleep: "3s"
