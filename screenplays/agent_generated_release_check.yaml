title: "Release Compliance Workflow"
output: "release_compliance_check"
variables:
  release_version: "v1.4.0"
  release_branch: "release/v1.4.0"
settings:
  width: 1440
  height: 900
  font_size: 22
  theme: "GruvboxDark"
  padding: 24
  window_bar: "Colorful"
  framerate: 60
  line_height: 1.15
  letter_spacing: 0
preinstall:
  - "echo 'Bootstrapping release compliance workflow'"
  - "python --version"
  - "git --version"
scenarios:
  - label: "Non-Compliant Candidate"
    surface: "terminal"
    setup:
      - "export RELEASE_VERSION={{release_version}}"
      - "export RELEASE_BRANCH={{release_branch}}"
    actions:
      - type: "echo \"Preparing ${RELEASE_VERSION} from ${RELEASE_BRANCH}\""
      - sleep: "700ms"
      - type: "echo '[check] lockfile freshness: FAIL (drift detected)'"
      - sleep: "500ms"
      - type: "echo '[check] security scan: PASS'"
      - sleep: "500ms"
      - type: "echo '[check] changelog coverage: FAIL (missing user-facing entry)'"
      - wait_for: "[check] changelog coverage: FAIL"
        wait_mode: "screen"
        wait_timeout: "2s"
      - type: "echo '[result] Release blocked until compliance gates are fixed.'"
      - sleep: "1s"
  - label: "Compliant Candidate"
    surface: "terminal"
    setup:
      - "export RELEASE_VERSION={{release_version}}"
      - "export RELEASE_BRANCH={{release_branch}}"
    actions:
      - type: "echo \"Preparing ${RELEASE_VERSION} from ${RELEASE_BRANCH}\""
      - sleep: "700ms"
      - type: "echo '[check] lockfile freshness: PASS'"
      - sleep: "500ms"
      - type: "echo '[check] security scan: PASS'"
      - sleep: "500ms"
      - type: "echo '[check] changelog coverage: PASS'"
      - wait_for: "[check] changelog coverage: PASS"
        wait_mode: "screen"
        wait_timeout: "2s"
      - type: "echo '[result] Release approved. Tag and publish artifacts.'"
      - sleep: "1s"
